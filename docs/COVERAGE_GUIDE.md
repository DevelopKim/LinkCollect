# 코드 커버리지 가이드

## 커버리지란?

코드 커버리지는 테스트가 실제 코드의 어느 정도를 실행했는지 측정하는 지표입니다.

### 커버리지 종류

1. **Statements (문장 커버리지)**: 실행된 코드 문장의 비율
2. **Branch (분기 커버리지)**: if/else, switch 등의 분기문 실행 비율
3. **Functions (함수 커버리지)**: 호출된 함수의 비율
4. **Lines (라인 커버리지)**: 실행된 코드 라인의 비율

## 일반적인 커버리지 기준

### 업계 표준

- **80% 이상**: 우수한 수준 (대부분의 엔터프라이즈 프로젝트 목표)
- **70-80%**: 양호한 수준 (일반적인 프로젝트 목표)
- **50-70%**: 보통 수준 (초기 단계에서 허용 가능)
- **50% 미만**: 부족한 수준 (테스트 보강 필요)
- **100%**: 이상적이지만 현실적으로 어려움 (특히 에러 핸들러, edge case)

### 프로젝트 단계별 기준

#### 초기 단계 (현재 단계)
- **목표: 50-60%**
- 핵심 기능 위주 테스트
- 주요 유틸리티 함수 커버
- Edge case는 후순위

#### 안정화 단계
- **목표: 70-80%**
- 모든 주요 기능 테스트
- 에러 핸들링 테스트
- Edge case 일부 커버

#### 프로덕션 단계
- **목표: 80% 이상**
- 대부분의 코드 경로 테스트
- 에러 케이스 커버
- 중요한 Edge case 커버

## 현재 프로젝트 커버리지 분석

### 전체 커버리지: 51.35%

```
Statements: 51.35%
Branch:     54.54%
Functions:  72.22%
Lines:      51.35%
```

### 파일별 커버리지

#### ✅ filter.ts: 67.74%
- **상태**: 양호
- **평가**: 필터링 로직이 잘 테스트됨
- **개선 여지**: `filterByRegex` 함수 미테스트

#### ⚠️ link-extractor.ts: 46.47%
- **상태**: 보통
- **평가**: 핵심 기능은 테스트됨
- **개선 필요**:
  - `extractLinksBySelector` 함수 미테스트 (확장용)
  - 에러 케이스 테스트 부족
  - Edge case (빈 텍스트, 특수 케이스 등)

#### ⚠️ url-utils.ts: 47.82%
- **상태**: 보통
- **평가**: 기본 기능은 테스트됨
- **개선 필요**:
  - 에러 케이스 테스트 부족
  - `isValidUrl`, `normalizeUrl` 함수 미테스트
  - Edge case (특수 URL, 잘못된 입력 등)

## 현재 수준 평가: 51.35%

### ✅ 긍정적 측면

1. **초기 단계 기준으로 적정 수준**
   - 프로젝트 초기 단계에서 51%는 허용 가능한 수준
   - 핵심 기능은 대부분 커버됨

2. **함수 커버리지가 높음 (72.22%)**
   - 주요 함수들이 테스트되고 있음
   - 핵심 로직 위주로 테스트 완료

3. **분기 커버리지가 양호 (54.54%)**
   - 조건문 처리가 어느 정도 테스트됨

### ⚠️ 개선 필요 사항

1. **에러 핸들링 테스트 부족**
   - 에러 케이스가 많이 누락됨
   - 예외 상황 처리 테스트 필요

2. **확장용 함수 미테스트**
   - `extractLinksBySelector` 같은 확장용 함수 미테스트
   - 향후 사용될 수 있는 함수들

3. **Edge Case 테스트 부족**
   - 특수한 입력값에 대한 테스트
   - 경계값 테스트

## 개선 계획

### 단기 목표 (60-70%)

1. **에러 케이스 테스트 추가**
   - 잘못된 URL 입력
   - DOM 접근 불가 상황
   - 네트워크 오류 시뮬레이션

2. **누락된 함수 테스트**
   - `extractLinksBySelector`
   - `isValidUrl`
   - `normalizeUrl`
   - `filterByRegex`

### 중기 목표 (70-80%)

1. **Edge Case 테스트**
   - 특수 문자 처리
   - 경계값 테스트
   - 대량 데이터 처리

2. **통합 테스트 보강**
   - 실제 사용 시나리오 테스트
   - 여러 함수 조합 테스트

## 커버리지 목표 설정

### 권장 설정 (vitest.config.ts)

```typescript
coverage: {
  provider: 'v8',
  reporter: ['text', 'json', 'html'],
  thresholds: {
    lines: 70,        // 라인 커버리지 70% 이상
    functions: 70,    // 함수 커버리지 70% 이상
    branches: 60,     // 분기 커버리지 60% 이상
    statements: 70,   // 문장 커버리지 70% 이상
  },
  exclude: [
    'node_modules/',
    'dist/',
    '**/*.d.ts',
    '**/*.config.*',
    '**/mockData/**',
  ],
},
```

## 결론

### 현재 상태: 보통 (51.35%)

- ✅ **초기 단계로서는 적정 수준**
- ✅ **핵심 기능은 잘 테스트됨**
- ⚠️ **에러 케이스와 Edge Case 테스트 보강 필요**
- 📈 **목표: 70% 이상 (안정화 단계)**

현재 51%는 프로젝트 초기 단계에서는 **충분히 허용 가능한 수준**입니다. 다만, 프로덕션 배포 전에는 최소 70% 이상을 목표로 하는 것이 좋습니다.

